<<<<<<< HEAD
/**
 * Load my app...
 */
var app = angular.module('MyApp', [
    'ngAnimate',
    'ui.materialize',
    'ngMessages',
    'ngRoute',
    'uiGmapgoogle-maps',
    'angular-loading-bar',
    'ngCookies',
    'ui.router'
  ]);
/**
 * Configure service
 */
app.config([
  'uiGmapGoogleMapApiProvider',
  '$cookiesProvider',
  function (uiGmapGoogleMapApiProvider, $cookiesProvider) {
    uiGmapGoogleMapApiProvider.configure({
      key: 'AIzaSyDZYt1LZydksFi5HC78apt6FOiQFuK-JVo',
      v: '3.20',
      libraries: 'weather,geometry,visualization'
    });
  }
]);
/**
 * Configure your routes
 */
app.factory('test', [
  '$http',
  function ($http) {
    return {
      nom: 'Boyer',
      prenom: 'Julien',
      test: function () {
        return $http.get('https://jsonblob.com/api/jsonBlob/57a8d915e4b0dc55a4eb7378').success(function (response) {
          return response;
        });
      }
    };
  }
]);
app.config([
  '$stateProvider',
  '$urlRouterProvider',
  function ($stateProvider, $urlRouterProvider) {
    //
    // For any unmatched url, redirect to /state1
    $urlRouterProvider.otherwise('/');
    //
    // Now set up the states
    $stateProvider.state('home', {
      url: '/',
      templateUrl: 'partials/users.html',
      controller: 'UsersCtrl',
      resolve: {
        message: function (test) {
          return test.test();
        }
      }
    });
  }
]);
// app.config(['$routeProvider',
//     function($routeProvider) {
//
//         // Système de routage
//         $routeProvider
//         .when('/', {
//             templateUrl: 'partials/users.html',
//             controller: 'UsersCtrl',
//
//         })
//         .when('/users', {
//             templateUrl: 'partials/users.html',
//             controller: 'UsersCtrl'
//         })
//         .when('/maps', {
//             templateUrl: 'partials/maps.html',
//             controller: 'MapCtrl'
//         })
//         .when('/map/:long/:lat', {
//             templateUrl: 'partials/map.html',
//             controller: 'MapCtrl'
//         })
//         .when('/user/:prenom/:nom', {
//             templateUrl: 'partials/user.html',
//             controller: 'UserCtrl'
//         })
//         .when('/contact', {
//             templateUrl: 'partials/contact.html',
//             controller: 'ContactCtrl'
//         })
//         .otherwise({ //sinon..redirection if 404
//             redirectTo: '/'
//         });
//     }
// ]);
/**
 * All Filters of you needs...
 * @Damien: Noublies pas de faire lefiltre ville.... :p
 */
app.filter('naissance', function () {
  return function (tableau, date) {
    if (date === undefined || date === null) {
      return tableau;
    }
    return _.filter(tableau, function (use) {
      return moment(use.birthday, 'DD/MM/YYYY') > moment(date);
    });
  };
});
app.filter('plus', function () {
  return function (tab, id) {
    obj = _.find(tab, function (obj) {
      return obj.id == id;
    });
    if (obj === undefined) {
      return false;
    }
    console.log(obj.compteur);
    return obj.compteur;
  };
});
app.filter('notes', function () {
  return function (tableau, note) {
    if (note === undefined || note === null) {
      return tableau;
    }
    return _.filter(tableau, function (use) {
      return use.noteBac >= note;
    });
  };
});
app.filter('range', function () {
  return function (tab, tranches) {
    //filters all true
    tranches = _.filter(tranches, function (elt) {
      return elt.checked === true;
    });
    if (tranches.length === 0) {
      return tab;
    }
    var tabFilter = [];
    _.each(tranches, function (tranche) {
      if (tranche.data === '10-25') {
        tabFilter.push(_.filter(tab, function (elt) {
          return elt.age >= 10 && elt.age <= 25;
        }));
      } else if (tranche.data === '25-45') {
        tabFilter.push(_.filter(tab, function (elt) {
          return elt.age >= 25 && elt.age <= 45;
        }));
      } else if (tranche.data === '45-60') {
        tabFilter.push(_.filter(tab, function (elt) {
          return elt.age >= 45 && elt.age <= 60;
        }));
      }
    });
    // concatener
    tabFilter = [].concat.apply([], tabFilter);
    return tabFilter;
  };
});
app.filter('sexe', function () {
  return function (sexe) {
    console.log();
    if (sexe === false) {
      return 'Femme';
    }
    return 'Homme';
  };
});
app.filter('age', function () {
  return function (tab, age) {
    return _.filter(tab, function (use) {
      return use.age;
    });
  };
});
app.controller('HeaderCtrl', [
  '$scope',
  '$rootScope',
  'filterFilter',
  '$http',
  function ($scope, $rootScope, filterFilter, $http) {
    $scope.searching = function () {
      //  $rootScope.users = filterFilter($rootScope.users, {nom: 'Lannister'}); // by attribute
      $rootScope.search = $scope.search;
      $rootScope.tri = $scope.tri;  // rootscope me sert a controller des données en dehors de ma scope courante
    };
  }
]);
app.controller('ContactCtrl', [
  '$scope',
  '$filter',
  '$http',
  function ($scope, $filter, $http) {
  }
]);
app.controller('UsersCtrl', [
  '$scope',
  'message',
  function ($scope, message) {
    console.log(message.data);  //  var currentTime = new Date();
                                //
                                //   // Bonus: charger les users by JSON
                                //   // //edit from https://jsonblob.com/57a59a90e4b0dc55a4eae792
                                //   // befor: https://jsonblob.com/api/jsonBlob/57a59a90e4b0dc55a4eae792
                                //    var users;
                                //
                                //    var myOnes = $scope.myOnes =  ($cookies.get('myOnes')) ?  $cookies.myOnes : [] ;
                                //
                                //
                                //     $http.get('https://jsonblob.com/api/jsonBlob/57a8d915e4b0dc55a4eb7378')
                                //     .success(function(response) {
                                //        $scope.users = users = response;
                                //        $scope.nbUsers = $scope.users.length;
                                //      });
                                //
                                //   // tranches
                                //    $scope.tranches = [
                                //       {"data": "10-25", "checked" : false},
                                //       {"data": "25-45", "checked" : false},
                                //       {"data": "45-60", "checked" : false},
                                //     ];
                                //
                                //     $scope.date = "01/01/1950";
                                //
                                //    $scope.tousMineur = function (){
                                //       return _.every($scope.users,function(user) {return user.age < 18;})
                                //    };
                                //
                                //
                                //    $scope.onePlus = function (id){
                                //      var myOnes = $scope.myOnes =  JSON.parse($cookies.get('myOnes'));
                                //
                                //     obj = _.find(myOnes, function(obj) { return obj.id == id })
                                //
                                //     // console.log(myOnes, _.findWhere(myOnes,{id: id}));
                                //     if(obj === undefined){
                                //         // initialize myOne
                                //         myOnes.push({
                                //           "id": id, "compteur": 1
                                //         });
                                //     }else{
                                //         // update myOne
                                //         obj.compteur =   obj.compteur + 1
                                //     }
                                //
                                //       console.log(myOnes);
                                //     // Setting a cookie
                                //     $cookies.put('myOnes', JSON.stringify(obj))
                                //    };
                                //
                                //
                                //
                                //    $scope.moyenneAge = function() {
                                //        var naissanceFilter = $filter('naissance');
                                //        var rangeFilter = $filter('range');
                                //        var notesFilter = $filter('notes');
                                //        var resFilter = naissanceFilter($scope.users,$scope.date);
                                //        var notesFilter = notesFilter(resFilter,$scope.notesBac);
                                //        var rangeFilter = rangeFilter(notesFilter,$scope.tranches);
                                //
                                //        // qui peut etre un filtre ...(merci Damien ^^)
                                //        var ville = $scope.cities;
                                //        if(ville !== undefined){
                                //          var rangeFilter = _.filter(rangeFilter, function(use){
                                //             return use.ville == ville;
                                //          });
                                //        }
                                //
                                //        // MAJ nb users
                                //        if( rangeFilter instanceof Array ) {
                                //          $scope.nbUsers = rangeFilter.length;
                                //          return _.reduce(rangeFilter, function(memo, num){
                                //            return memo + num.age;
                                //          },0) / (rangeFilter.length === 0 ? 1 : rangeFilter.length);
                                //        }
                                //
                                //        return rangeFilter;
                                //
                                //      };
                                //
                                //      $scope.removeUser = function(user){
                                //            var index = $scope.users.indexOf(user);
                                //            $scope.users.splice(index, 1);
                                //      }
                                //
                                //      $scope.add = function(form){
                                //
                                //        console.log($scope.nom,$scope.age,$scope.dob,$scope.photo, $scope.noteauBac,$scope.sexe, $scope.ville,  $scope.biographie);
                                //        if(form.$valid) {
                                //
                                //          $scope.users.push({
                                //             nom: $scope.nom,
                                //             prenom:  $scope.prenom,
                                //             age: parseInt($scope.age),
                                //             photo:  $scope.photo,
                                //             birthday:  $scope.dob,
                                //             noteBac:  parseInt($scope.noteauBac),
                                //             sexe:  $scope.sexe,
                                //             ville: $scope.ville,
                                //             biographie: $scope.biographie
                                //          });
                                //
                                //          $scope.nom =  $scope.sexe = $scope.ville =  $scope.biographie = $scope.prenom = $scope.age = $scope.photo = $scope.dob = $scope.noteauBac = "";
                                //
                                //        }else{
                                //          console.log("Formulaire invalide", form);
                                //        }
                                //
                                //      }
  }
]);
app.controller('UserCtrl', [
  '$scope',
  '$routeParams',
  '$http',
  function ($scope, $routeParams, $http) {
    $scope.prenom = $routeParams.prenom;
    $scope.nom = $routeParams.nom;
    var user;
    $http.get('https://jsonblob.com/api/jsonBlob/57a86573e4b0dc55a4eb50a7').success(function (response) {
      users = response;
      var user = $scope.user = _.find(users, function (user) {
          return user.nom == $scope.nom && user.prenom == $routeParams.prenom;
        });
    });
  }
]);
app.controller('MapCtrl', [
  '$scope',
  '$routeParams',
  function ($scope, $routeParams) {
    $scope.map = {
      center: {
        latitude: $routeParams.lat,
        longitude: $routeParams.long
      },
      zoom: 13
    };
    $scope.markers = [{
        coord: {
          latitude: $routeParams.lat,
          longitude: $routeParams.long
        },
        email: 'netapsys@netapsys.fr',
        icon: 'https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png',
        id: 412
      }];
  }
]);
app.controller('MapsCtrl', [
  '$scope',
  '$http',
  function ($scope, $http) {
    console.log('coucou');
    $scope.map = {
      center: {
        latitude: 45.75,
        longitude: 4.85
      },
      zoom: 10
    };
    $scope.markers = [];
    $http.get('https://jsonblob.com/api/jsonBlob/57a86573e4b0dc55a4eb50a7').success(function (response) {
      _.each(response, function (elt) {
        $scope.markers.push({
          coord: {
            latitude: elt.geolocalisation.lat,
            longitude: elt.geolocalisation.long
          },
          email: 'netapsys@netapsys.fr',
          icon: 'https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png',
          id: 412
        });
      });
    });
    $scope.clickMarker = function (marker) {
      alert(marker.email);  //Affichera l'email du point sur lequel on a cliqué
    };
  }
]);
=======
var app=angular.module("MyApp",["ngAnimate","ngRoute","ui.materialize","ngMessages","ui.router","uiGmapgoogle-maps","angular-loading-bar","ngCookies"]);app.config(["uiGmapGoogleMapApiProvider",function(e){e.configure({key:"AIzaSyDZYt1LZydksFi5HC78apt6FOiQFuK-JVo",v:"3.20",libraries:"weather,geometry,visualization"})}]),app.factory("userFactory",["$http",function(e){var t={};return t.getAll=function(){return e.get("https://jsonblob.com/api/jsonBlob/57a8d915e4b0dc55a4eb7378").success(function(e){return e})},t.getOne=function(e,t){var n=this.getAll();return!!n&&_.find(n,function(n){return n.nom==e&&n.prenom==t})},t.add=function(e,t){return t.push({nom:e.nom,prenom:e.prenom,age:parseInt(e.age),photo:e.photo,birthday:e.dob,noteBac:parseInt(e.noteauBac),sexe:e.sexe,ville:e.ville,biographie:e.biographie})},t.remove=function(e,t){var n=t.indexOf(e);return t.splice(n,1),t},t.hasMinor=function(e){return _.every(e,function(e){return e.age<18})},t.moyenneAge=function(e){return _.reduce(rangeFilter,function(e,t){return e+t.age},0)/(0===rangeFilter.length?1:rangeFilter.length)},t}]),app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"partials/users.html",controller:"UsersCtrl",resolve:{properties:function(){return{name:"Banner",slug:"banner"}}}}).when("/users",{templateUrl:"partials/users.html",controller:"UsersCtrl"}).when("/maps",{templateUrl:"partials/maps.html",controller:"MapCtrl"}).when("/map/:long/:lat",{templateUrl:"partials/map.html",controller:"MapCtrl"}).when("/user/:prenom/:nom",{templateUrl:"partials/user.html",controller:"UserCtrl"}).when("/contact",{templateUrl:"partials/contact.html",controller:"ContactCtrl"}).otherwise({redirectTo:"/"})}]),app.filter("departement",function(){return function(e,t){return t?_.filter(e,function(e){return e.codepostal.toString().substr(0,2)==t.substr(0,2)}):e}}),app.filter("drapeau",function(){return function(e){switch(e){case"es":return"http://www.europetrotteur.com/images/drapeau_Espagne.png";case"en":return"http://www.europetrotteur.com/images/drapeau_United%20Kingdom.png";case"it":return"http://www.europetrotteur.com/images/drapeau_Italie.png";case"fr":return"http://www.europetrotteur.com/images/drapeau_France.png";default:return"http://flags-and-anthems.com/images/flags/flag-switzerland-flagge-quadratischweiss-13x13.gif"}}}),app.filter("mineur",function(){return function(e,t){var n=[],r=[];return void 0==t?e:(_.each(e,function(e){e.age>=18?n.push(e):r.push(e)}),0==t?(t=!0,r):(t=!1,n))}}),app.filter("naissance",function(){return function(e,t){return void 0===t||null===t?e:_.filter(e,function(e){return moment(e.birthday,"DD/MM/YYYY")>moment(t)})}}),app.filter("plus",function(){return function(e,t){return obj=_.find(e,function(e){return e.id==t}),void 0!==obj&&obj.compteur}}),app.filter("notes",function(){return function(e,t){return void 0===t||null===t?e:_.filter(e,function(e){return e.noteBac>=t})}}),app.filter("range",function(){return function(e,t){if(t=_.filter(t,function(e){return e.checked===!0}),0===t.length)return e;var n=[];return _.each(t,function(t){"10-25"===t.data?n.push(_.filter(e,function(e){return e.age>=10&&e.age<=25})):"25-45"===t.data?n.push(_.filter(e,function(e){return e.age>=25&&e.age<=45})):"45-60"===t.data&&n.push(_.filter(e,function(e){return e.age>=45&&e.age<=60}))}),n=[].concat.apply([],n)}}),app.filter("sexe",function(){return function(e){return console.log(),e===!1?"Femme":"Homme"}}),app.filter("search",function(){return function(e,t){var n=[],r=new RegExp(t,"i");return""===t||void 0===t?e:(angular.forEach(e,function(e,t){var o=e.nom,a=e.prenom;r.test(o+" "+a)&&n.push(e)}),n)}}),app.filter("age",function(){return function(e,t){return _.filter(e,function(e){return e.age})}}),app.controller("HeaderCtrl",["$scope","$rootScope","filterFilter","$http",function(e,t,n,r){e.searching=function(){t.search=e.search,t.tri=e.tri}}]),app.controller("ContactCtrl",["$scope","$filter","$http",function(e,t,n){}]),app.controller("UsersCtrl",["$scope","$filter","$http","$cookies","$route",function(e,t,n,r,o){new Date;console.log(o.current.locals.properties);var a;e.myOnes=r.get("myOnes")?r.myOnes:[];n.get("https://jsonblob.com/api/57aaf50ce4b0dc55a4ebcca7").success(function(t){e.users=a=t,e.nbUsers=e.users.length}),e.tranches=[{data:"10-25",checked:!1},{data:"25-45",checked:!1},{data:"45-60",checked:!1}],e.date="01/01/1950",e.tousMineur=function(){return _.every(e.users,function(e){return e.age<18})},e.onePlus=function(t){var n=e.myOnes=JSON.parse(r.get("myOnes"));obj=_.find(n,function(e){return e.id==t}),void 0===obj?n.push({id:t,compteur:1}):obj.compteur=obj.compteur+1,console.log(n),r.put("myOnes",JSON.stringify(obj))},e.anniv=function(e){return moment().format("MM")===moment(e,"DD/MM/YYYY").format("MM")},e.moyenneAge=function(){var n=t("naissance"),r=t("range"),o=t("notes"),a=n(e.users,e.date),o=o(a,e.notesBac),r=r(o,e.tranches),i=e.cities;if(void 0!==i)var r=_.filter(r,function(e){return e.ville==i});return r instanceof Array?(e.nbUsers=r.length,_.reduce(r,function(e,t){return e+t.age},0)/(0===r.length?1:r.length)):r},e.removeUser=function(t){var n=e.users.indexOf(t);e.users.splice(n,1)},e.add=function(t){console.log(e.nom,e.age,e.dob,e.photo,e.noteauBac,e.sexe,e.ville,e.biographie),t.$valid?(e.users.push({nom:e.nom,prenom:e.prenom,age:parseInt(e.age),photo:e.photo,birthday:e.dob,noteBac:parseInt(e.noteauBac),sexe:e.sexe,ville:e.ville,biographie:e.biographie}),e.nom=e.sexe=e.ville=e.biographie=e.prenom=e.age=e.photo=e.dob=e.noteauBac=""):console.log("Formulaire invalide",t)}}]),app.controller("UserCtrl",["$scope","$routeParams","$http",function(e,t,n){e.prenom=t.prenom,e.nom=t.nom;n.get("https://jsonblob.com/api/jsonBlob/57a86573e4b0dc55a4eb50a7").success(function(n){users=n;e.user=_.find(users,function(n){return n.nom==e.nom&&n.prenom==t.prenom})})}]),app.controller("MapCtrl",["$scope","$routeParams",function(e,t){e.map={center:{latitude:t.lat,longitude:t.long},zoom:13},e.markers=[{coord:{latitude:t.lat,longitude:t.long},email:"netapsys@netapsys.fr",icon:"https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png",id:412}]}]),app.controller("MapsCtrl",["$scope","$http",function(e,t){console.log("coucou"),e.map={center:{latitude:45.75,longitude:4.85},zoom:10},e.markers=[],t.get("https://jsonblob.com/api/jsonBlob/57a86573e4b0dc55a4eb50a7").success(function(t){_.each(t,function(t){e.markers.push({coord:{latitude:t.geolocalisation.lat,longitude:t.geolocalisation.long},email:"netapsys@netapsys.fr",icon:"https://maps.gstatic.com/mapfiles/api-3/images/spotlight-poi.png",id:412})})}),e.clickMarker=function(e){alert(e.email)}}]);
>>>>>>> 8bf46c54c2667f2cc22c196d741da11eb9686afd
